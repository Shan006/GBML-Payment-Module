# GBML API Integration Guide for Vendors

Welcome to the GBML Payments Module integration guide. This document provides technical instructions for vendors and partners who wish to integrate their services with the GBML ecosystem using our secure API key system and RBAC (Role-Based Access Control).

## 1. Authentication

All requests to the GBML API must be authenticated using an **API Key**. These keys are generated by the GBML Admin and tied to specific tenants and roles.

### Using the API Key
Include your API key in the `Authorization` header of every request:

```http
Authorization: Bearer gbml_your_api_key_here
```

> [!WARNING]
> Your API key is highly sensitive. Never expose it in client-side code (frontend), public repositories, or logs. Use environment variables to store it securely.

## 2. Roles & Permissions

GBML uses a role-based system to ensure secure operation. Depending on your service type, you will be assigned one or more of the following roles:

| Role | Allowed Actions | Use Case |
| :--- | :--- | :--- |
| `PROGRAM` | Create disbursement requests, initiate fiat payments. | Funding programs, payroll apps, e-commerce. |
| `TREASURY` | Execute approved disbursements, mint tokens, move treasury funds. | Internal treasury management, authorized signers. |
| `COMPLIANCE`| View audit logs, update exchange rates, trigger pauses. | Monitoring systems, compliance officers. |

## 3. Core API Endpoints

### 3.1 Program Disbursements
If your app manages disbursements, follow this asynchronous flow:

#### Step A: Request Disbursement (`PROGRAM` role)
**Endpoint**: `POST /gbml/program/disbursements`

**Request Body**:
```json
{
  "amount": "1000.50",
  "tokenAddress": "0xTokenAddress...",
  "recipientAddress": "0xRecipientAddress...",
  "reason": "Invoice #1234Payment"
}
```

#### Step B: Monitoring Status
**Endpoint**: `GET /gbml/disbursements?status=PENDING`
Requests remain `PENDING` until a user with the `TREASURY` role executes them.

---

### 3.2 Fiat Payment Gateway
To initiate a fiat-to-token payment (e.g., a customer paying USD via Stripe to receive JRC-20 tokens).

#### Create Payment Intent
**Endpoint**: `POST /gbml/fiat/payment/create`

**Request Body**:
```json
{
  "token": "GBML",
  "currency": "USD",
  "amount": 50.00,
  "recipientAddress": "0xYourWallet..."
}
```

**Response**: Returns a `clientSecret` which you should pass to the Stripe Frontend SDK to complete the payment.

---

### 3.3 Treasury Operations (`TREASURY` role only)
For high-privilege services that execute transactions on the blockchain.

#### Execute Disbursement
**Endpoint**: `POST /gbml/treasury/disbursements/:requestId/execute`

---

## 4. Error Handling

GBML uses standard HTTP status codes:

- `200/201`: Success
- `401 Unauthorized`: Missing or invalid API Key.
- `403 Forbidden`: API Key lacks the required role for this action.
- `429 Too Many Requests`: Rate limit exceeded.
- `503 Service Unavailable`: System is in **Emergency Pause** mode.

## 5. Webhooks (Optional)

We recommend setting up a webhook listener to receive real-time updates for:
- Payment success/failure
- Disbursement execution
- Emergency pause triggers

Contact your GBML administrator to register your webhook URL.

## 6. Audit Logging

Every action performed via your API Key is recorded in the GBML Audit Trail. This log includes:
- IP Address
- Timestamp
- Action performed
- Payload (redacted sensitive info)
- Success/Failure status

This ensures full transparency and compliance for both vendors and the GBML platform.
